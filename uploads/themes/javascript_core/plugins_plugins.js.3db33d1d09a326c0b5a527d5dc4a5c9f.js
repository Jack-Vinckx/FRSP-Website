;(function($,_,undefined){"use strict";ips.controller.register('customWidget',{initialize:function(){if(this.scope.hasClass('fw_switchertype_advanced')){this.on('click','.fw_Arrow',this.widgetContainer);this.cookie();}else{this.on('click','.fw_Arrow',this.widgetContainerA);}},widgetContainerA:function(){this.scope.toggleClass('sOpen');},cookie:function(){var widgetId=this.scope.attr('id');this.scope.addClass(ips.utils.db.get('myCategory',widgetId));},widgetContainer:function(){var widget=this.scope;var widgetId=this.scope.attr('id');if(widget.hasClass('sOpen')){ips.utils.db.remove('myCategory',widgetId);}else{ips.utils.db.set('myCategory',widgetId,'sOpen');}
this.scope.toggleClass('sOpen');}});}(jQuery,_));;$(document).ready(function(){$('body').on('click','[data-ppbb-preview]',function(event){event.preventDefault();$(this).closest('form').find('[data-ipsEditor]').trigger('togglePreview');});});;;(function($,_,undefined){"use strict";ips.controller.register('plugins.minimizequote',{initialize:function(){if($('.ipsQuote').length){var quoteColor=$('.ipsQuote').css('backgroundColor');if(quoteColor.indexOf('rgba')===-1){var fromColor=quoteColor.replace('rgb','rgba').replace(')',', 0)');var toColor=quoteColor.replace('rgb','rgba').replace(')',', 1)');var css=document.createElement("style");css.type="text/css";css.innerHTML="div.ipsQuote_contents.ipsTruncate:not(.ipsTruncate_expanded):after { background: linear-gradient( "+fromColor+", "+toColor+"); -webkit-transition: opacity 0.5s ease; -moz-transition: opacity 0.5s ease; transition: opacity 0.5s ease; pointer-events: none; content: ''; width: 100%; height: 50px; position: absolute; left: 0; bottom: 0; visibility: visible; }";document.body.appendChild(css);}}
this.minimizeQuotes();var that=this;$(document).on('contentChange',function(e,newContent){if(newContent instanceof jQuery){newContent.each(function(){if(_.isUndefined($(this).attr('data-ipseditor'))&&$(this).parents('.cke_wysiwyg_div').length==0){that.minimizeQuotes();}});}
else{if(_.isUndefined($(newContent).attr('data-ipseditor'))&&$(newContent).parents('.cke_wysiwyg_div').length==0){that.minimizeQuotes();}}
if(typeof PR!='undefined'){PR.prettyPrint();}});if(!_.isUndefined(window.CKEDITOR)){this.fixEditorQuotes();}},loadTries:0,fixEditorQuotes:function(){if((!CKEDITOR||_.isUndefined(CKEDITOR.on))&&this.loadTries<60){this.loadTries++;setTimeout(_.bind(this.fixEditorQuotes,this),50);return;}
CKEDITOR.on('afterInsertHtml',this.doFixEditorQuotes);},doFixEditorQuotes:function(e){var editorContent=$("<div id='specialwrapperthing'>"+e.editor.getData()+"</div>");if(editorContent){$('.ipsTruncate_more',$(editorContent)).remove();$('.ipsQuote_contents',$(editorContent)).each(function(){$(this).removeClass('ipsTruncate ipsClearfix');if($(this).prop('style')['height']!==""||!_.isUndefined($(this).attr('data-minimizedQuoteWasHere'))){Debug.log('Fixing a messed up quote');$(this).removeAttr('style').removeAttr('data-minimizedQuoteWasHere');}});Debug.log(editorContent);e.editor.setData($(editorContent).html());}},minimizeQuotes:function(){var that=this;var size=parseInt(ips.getSetting('minimizeQuote_size'));var commentIds=[];$('blockquote[data-ipsquote]').each(function(){var quoteContentsDiv=$(this).children('.ipsQuote_contents');if(!quoteContentsDiv.length){var citation=$(this).children('.ipsQuote_citation');$(this).children().wrapAll("<div class='ipsQuote_contents' />");if(citation.length>0){citation.detach();$(this).prepend(citation);}
quoteContentsDiv=$(this).children('.ipsQuote_contents');}
if((!_.isUndefined($(quoteContentsDiv).prop('style'))&&$(quoteContentsDiv).prop('style')['height']!=='')||!_.isUndefined($(quoteContentsDiv).attr('data-minimizedQuoteWasHere'))){if($(quoteContentsDiv).prop('style')['height']=='auto'&&$(quoteContentsDiv).prop('style')['position']=='static'&&$(quoteContentsDiv).hasClass('ipsTruncate_expanded')){Debug.log("We've just expanded this one");return;}
Debug.log('Fixing messed up quote');$(quoteContentsDiv).removeAttr('style').removeAttr('data-minimizedQuoteWasHere').removeClass('ipsTruncate ipsClearfix');$(this).children('.ipsTruncate_more').remove();}
Debug.log($(quoteContentsDiv));if(!_.isUndefined($(quoteContentsDiv).attr('data-ipseditor'))||$(this).closest('.ipsComposeArea').length||!_.isUndefined($(quoteContentsDiv).attr('contenteditable'))||$(this).parents('.cke_wysiwyg_div').length){Debug.log('In editor');return;}
$(quoteContentsDiv).attr('data-minimizedQuoteWasHere',1);if(parseInt(ips.getSetting('minimizeQuote_showFirstAppear'))==1){var quoteCommentId=parseInt($(this).attr('data-ipsquote-contentcommentid'));if($.inArray(quoteCommentId,commentIds)!==-1||$('div [data-commentid="'+quoteCommentId+'"]').length>0){ips.ui.truncate.respond($(quoteContentsDiv),{type:'hide',size:size+' lines'});}
else{commentIds.push(quoteCommentId);}}
else{ips.ui.truncate.respond($(quoteContentsDiv),{type:'hide',size:size+' lines'});}
$(quoteContentsDiv).on('truncateExpanded',function(){$(quoteContentsDiv).addClass('ipsTruncate_expanded');})});}});}(jQuery,_));;;(function($,_,undefined){"use strict";ips.controller.register('plugins.bimGiphy',{_timer:null,_ajax:null,_value:'',_type:'gifs',initialize:function(){this.on('click','[data-action="playGif"]',this.playGif);this.on('click','[data-action="selectGif"]',this.insertGif);this.on('focus','[data-role="gifSearch"]',this.focusGifSearch);this.on('blur','[data-role="gifSearch"]',this.blurGifSearch);this.on('change','[data-role="gifType"]',this._checkValue);this.on('paginationClicked paginationJump',this.paginationClicked);},playGif:function(e){var container=$(e.currentTarget).prev();var bg=container.css('background-image');bg=bg.replace('url(','').replace(')','').replace(/\"/gi,"");var gif=container.attr('data-preview');if(bg!=gif){container.css('background-image','url('+gif+')');console.log("Playing GIF");}},insertGif:function(e){var element=$(e.currentTarget).attr('class');var id=$(e.currentTarget).attr('data-gifid');var gif=$(e.currentTarget).attr('data-original');var title=$(e.currentTarget).closest('.giphyIMG').attr('title');var original=$(e.currentTarget).attr('data-original');var preview_gif=$(e.currentTarget).attr('data-preview');var still=$(e.currentTarget).attr('data-still');var eID=$(this.scope).data('editorid');if(eID.toLowerCase().indexOf("chatbox_")==0&&eID.toLowerCase().indexOf("chatbox_content_ajax")<0){var evar=eID.split("_");var cbWrapper=evar[1]=='room'?$('.room_'+evar[2]):$('.convo_'+evar[2]);cbWrapper.find('.bimcb_chatInput').val(gif).closest('form').find('[type="submit"]').click();}
else if(eID=='chatbox'){$('[data-controller="bim.chatbox.free"]').find('.bimcb_chatInput').val(gif);$('[data-controller="bim.chatbox.free"]').find('.bimcb_chatInput').closest('form').find('[type="submit"]').click();}
else if(eID=='giphyCMD'){var mediaBox=this.scope.closest('.chatboxMedia');mediaBox.empty().hide();mediaBox.next().find('.bimcb_chatInput').val(gif).submit();}
else{var editor=CKEDITOR.instances[eID];if(ips.getSetting('bim_giphy_play')==1){editor.insertHtml('<img alt="'+title+'" class="ipsImage bimGiphyIMG" src="'+gif+'">');}
else{var element=CKEDITOR.dom.element.createFromHtml('<div class="bimGiphyContainer" contenteditable="false"></div>');element.setHtml('<img alt="'+title+'" class="ipsImage bimGiphyIMG" src="'+still+'"><div class="giphyPlayBtn"></div>');element.isEditable=false;editor.insertElement(element);editor.widgets.initOn(element,'bimGiphyContainer');$(document).trigger('contentChange',[$(element.$)]);}}
var item={'id':id,'title':title,'images':{'original':{'url':original},'preview_gif':{'url':preview_gif},'original_still':{'url':still}}};var existing=ips.utils.db.get('bimgiphy_gif','recent');if(!existing||!_.isArray(existing)){var json=[item];ips.utils.db.set('bimgiphy_gif','recent',json);}
else{for(var key in existing){var obj=existing[key];if(obj.id==item.id){this.trigger('closeDialog');return;}}
existing.unshift(item);if(existing.length>12){existing.splice((existing.length-12)*-1,existing.length-12);}
ips.utils.db.set('bimgiphy_gif','recent',existing);}
this.trigger('closeDialog');},paginationClicked:function(e,data){var self=this;var results=this.scope.find('[data-role="gifResults"]');var url=data.href;data.originalEvent.preventDefault();if(url=='#'){url=data.paginationElem.find('[data-role="pageJump"]').attr('action')+'&page='+data.pageNo;}
this._ajax=ips.getAjax()(url,{showLoading:true,data:{q:this._value,type:this._type,}}).done(function(response){results.html(response);$(document).trigger('contentChange',[results]);});},focusGifSearch:function(){this._timer=setInterval(_.bind(this._checkValue,this),700);},blurGifSearch:function(){clearInterval(this._timer);},_checkValue:function(){var value=this.scope.find('[data-role="gifSearch"]').val();var type=this.scope.find('[data-role="gifType"]').val();if(value==this._value&&type==this._type){return;}
this._value=value;this._type=type;this._loadResults();},_loadResults:function(){var self=this;var url=this.scope.attr('data-url');var recent=ips.utils.db.get('bimgiphy_gif','recent');var recentData=null;if(!this._value){if(_.isArray(recent)){recentData=JSON.stringify(recent);}}
if(this._ajax&&this._ajax.abort){this._ajax.abort();}
this.scope.find('[data-role="gifSearch"]').addClass('ipsField_loading');this._ajax=ips.getAjax()(url,{data:{q:this._value,type:this._type,offset:0,recent:recentData},type:'post',}).done(function(response){self.scope.find('[data-role="gifResults"]').html(response);$(document).trigger('contentChange',[self.scope.find('[data-role="gifResults"]')]);}).always(function(){self.scope.find('[data-role="gifSearch"]').removeClass('ipsField_loading');});}});}(jQuery,_));$(document).ready(function(){$(document).on('click touchend','.giphyPlayBtn',function(e){var container=$(this).closest('.bimGiphyContainer');var img=container.find('.bimGiphyIMG');var gifURL=img.attr('src').replace("giphy_s.gif","giphy.gif");if($(this).closest('.cke_inner').length<=0){img.attr('src',gifURL);}
else{var gifID="giphy_"+makeid();container.addClass(gifID);img.addClass('giphyInvisible');var div=$("<div />",{html:"&shy;<style>.cke_inner ."+gifID+" { background-image: url('"+gifURL+"') }</style>"}).appendTo("body");}
$(this).addClass('giphyHide');return false;});function makeid(){var text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<5;i++)
text+=possible.charAt(Math.floor(Math.random()*possible.length));return text;}});;